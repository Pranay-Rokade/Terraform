# Terraform Learning Journey

This document outlines my comprehensive learning journey with Terraform, covering fundamental concepts to advanced features including **interpolation**, a key concept I implemented throughout. Below is a structured breakdown of the topics explored and commands used.

---

## Table of Contents
1. [Getting Started](#getting-started)
2. [S3 Bucket Creation](#s3-bucket-creation)
3. [EC2 Instance Management](#ec2-instance-management)
4. [Variables and Outputs](#variables-and-outputs)
5. [Dynamic Blocks and Loops](#dynamic-blocks-and-loops)
6. [State Management](#state-management)
7. [Workspaces and Environments](#workspaces-and-environments)
8. [Modules](#modules)
9. [Interpolation](#interpolation)

---

## Getting Started
- **Initialization**:  
  Used `terraform init` to initialize the Terraform working directory.  
  Example:  
  ```bash
  terraform init
  ```

- **Validation**:  
  Validated configurations with `terraform validate`.  
  Example:  
  ```bash
  terraform validate
  ```

- **Formatting**:  
  Ensured consistent code formatting using `terraform fmt`.  
  Example:  
  ```bash
  terraform fmt
  ```

---

## S3 Bucket Creation
- **Resource Definition**:  
  Created an S3 bucket using the `aws_s3_bucket` resource.  
  Example:  
  ```hcl
  resource "aws_s3_bucket" "my_s3_bucket" {
    bucket = "pranay-terraform"
  }
  ```

- **Execution**:  
  Applied changes with `terraform apply` and destroyed resources with `terraform destroy`.  
  Example:  
  ```bash
  terraform apply
  terraform destroy
  ```

---

## EC2 Instance Management
- **Key Pair**:  
  Created a key pair for EC2 instance access.  
  Example:  
  ```hcl
  resource "aws_key_pair" "deployer" {
    key_name   = "terraform-ec2-key"
    public_key = file("terraform-ec2-key.pub")
  }
  ```

- **Security Group**:  
  Defined a security group with inbound and outbound rules.  
  Example:  
  ```hcl
  resource "aws_security_group" "my_sg" {
    name        = "automated_security_group"
    description = "Security group generated by Terraform"
    vpc_id      = aws_default_vpc.default.id  # Interpolation used here
  }
  ```

- **EC2 Instance**:  
  Launched an EC2 instance with user data for Nginx installation.  
  Example:  
  ```hcl
  resource "aws_instance" "my_ec2" {
    ami           = var.ami_id
    instance_type = var.instance_type
    key_name      = aws_key_pair.deployer.key_name  # Interpolation used here
    security_groups = [aws_security_group.my_sg.name]  # Interpolation used here
    user_data     = file("install_nginx.sh")
  }
  ```

---

## Variables and Outputs
- **Variables**:  
  Used variables to parameterize configurations.  
  Example:  
  ```hcl
  variable "ami_id" {
    description = "AMI ID for the EC2 instance"
    default     = "ami-02521d90e7410d9f0"
    type        = string
  }
  ```

- **Outputs**:  
  Displayed instance details using outputs with interpolation.  
  Example:  
  ```hcl
  output "public_ip" {
    value = aws_instance.my_ec2.public_ip  # Interpolation used here
  }
  ```

---

## Dynamic Blocks and Loops
- **Count**:  
  Created multiple instances using `count`.  
  Example:  
  ```hcl
  resource "aws_instance" "my_ec2" {
    count = 3
    ami   = var.ami_id
    # ... other configurations ...
  }
  ```

- **For Each**:  
  Used `for_each` to create instances with different configurations.  
  Example:  
  ```hcl
  resource "aws_instance" "my_ec2" {
    for_each = tomap({
      instance1 = "t2.micro",
      instance2 = "t2.nano"
    })
    instance_type = each.value
    tags = {
      Name = each.key
    }
  }
  ```

---

## State Management
- **Remote Backend**:  
  Configured an S3 backend with DynamoDB for state locking.  
  Example:  
  ```hcl
  terraform {
    backend "s3" {
      bucket         = "my-remote-bucket"
      key            = "terraform.tfstate"
      region         = "ap-south-1"
      dynamodb_table = "remote-state-table"
    }
  }
  ```

- **State Commands**:  
  Used commands like `terraform state list`, `terraform state show`, and `terraform import` for state management.  
  Example:  
  ```bash
  terraform state list
  terraform state show aws_key_pair.deployer
  ```

---

## Workspaces and Environments
- **Workspaces**:  
  Managed multiple environments using workspaces.  
  Example:  
  ```bash
  terraform workspace new development
  terraform workspace select default
  ```

- **Git Integration**:  
  Mapped Git branches (`prd` and `dev`) to Terraform workspaces for multi-stage environments.  

---

## Modules
- **VPC Module**:  
  Used the Terraform AWS VPC module to create a VPC with subnets.  
  Example:  
  ```hcl
  module "vpc" {
    source = "terraform-aws-modules/vpc/aws"

    name = "my-vpc"
    cidr = "10.0.0.0/16"
    azs  = ["ap-south-1a", "ap-south-1b", "ap-south-1c"]
  }
  ```

---

## Interpolation
Interpolation is a powerful feature in Terraform that allows you to reference variables, attributes, and functions dynamically within your configurations. Below are examples of how I implemented interpolation:

### Key Concepts:
1. **Referencing Resources**:  
   Used interpolation to reference attributes of other resources.  
   Example:  
   ```hcl
   vpc_id = aws_default_vpc.default.id  # References the ID of the default VPC
   ```

2. **Variable Interpolation**:  
   Dynamically inserted variable values into configurations.  
   Example:  
   ```hcl
   ami = var.ami_id  # References the AMI ID variable
   ```

3. **Function Interpolation**:  
   Used built-in functions like `file()` to read external files.  
   Example:  
   ```hcl
   user_data = file("install_nginx.sh")  # Reads the content of the script file
   ```

4. **Output Interpolation**:  
   Referenced resource attributes in outputs.  
   Example:  
   ```hcl
   output "arn" {
     value = aws_instance.my_ec2.arn  # References the ARN of the EC2 instance
   }
   ```

### Practical Use Cases:
- **Security Group Rules**:  
  Interpolated the VPC ID into the security group configuration.  
  ```hcl
  vpc_id = aws_default_vpc.default.id
  ```

- **Key Pair Reference**:  
  Dynamically referenced the key pair name in the EC2 instance.  
  ```hcl
  key_name = aws_key_pair.deployer.key_name
  ```

- **Conditional Interpolation**:  
  Used conditional expressions to set values based on variables.  
  ```hcl
  volume_size = var.environment == "production" ? 30 : var.default_root_volume_size
  ```

---

## Conclusion
This journey covered Terraform from basics to advanced topics, including **interpolation**, resource management, dynamic configurations, state handling, and modular design. Each step was validated with commands like `terraform plan` and `terraform apply`, ensuring a thorough understanding of Terraform's capabilities.  

For further exploration, refer to the [Terraform documentation](https://www.terraform.io/docs).
